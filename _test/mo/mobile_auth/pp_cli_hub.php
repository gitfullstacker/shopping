<?
    /* ============================================================================== */
    /* =   PAGE : ���� ��û �� ��� ó�� PAGE                                       = */
    /* = -------------------------------------------------------------------------- = */
    /* =   ������ ������ �߻��ϴ� ��� �Ʒ��� �ּҷ� �����ϼż� Ȯ���Ͻñ� �ٶ��ϴ�.= */
    /* =   ���� �ּ� : http://kcp.co.kr/technique.requestcode.do			        = */
    /* = -------------------------------------------------------------------------- = */
    /* =   Copyright (c)  2013   KCP Inc.   All Rights Reserverd.                   = */
    /* ============================================================================== */

    /* ============================================================================== */
    /* =   ȯ�� ���� ���� Include                                                   = */
    /* = -------------------------------------------------------------------------- = */
    /* =   �� �ʼ�                                                                  = */
    /* =   �׽�Ʈ �� �ǰ��� ������ site_conf_inc.php������ �����Ͻñ� �ٶ��ϴ�.     = */
    /* = -------------------------------------------------------------------------- = */

    /* = -------------------------------------------------------------------------- = */
    /* =   ȯ�� ���� ���� Include END                                               = */
    /* ============================================================================== */
?>
<?include_once $_SERVER['DOCUMENT_ROOT'] . "/kcp/cfg/site_mbconf_inc.php";?>
<?include_once $_SERVER['DOCUMENT_ROOT'] . "/_test/mo/mobile_auth/pp_cli_hub_lib.php";?>
<?
    /* ============================================================================== */
    /* =   POST ���� üũ�κ�                                                       = */
    /* = -------------------------------------------------------------------------- = */
    if ( $_SERVER['REQUEST_METHOD'] != "POST" )
    {
        echo("�߸��� ��η� �����Ͽ����ϴ�.");
        exit;
    }
    /* ============================================================================== */
?>

<?
    /* ============================================================================== */
    /* =   01. ���� ��û ���� ����                                                  = */
    /* = -------------------------------------------------------------------------- = */
    $cust_ip        = getenv( "REMOTE_ADDR"    ); // ��û IP
    /* = -------------------------------------------------------------------------- = */
    $req_tx         = $_POST[ "req_tx"         ]; // ��û ����
    $tran_cd        = $_POST[ "tran_cd"        ]; // ó�� ����
    /* = -------------------------------------------------------------------------- = */
    $ordr_idxx      = $_POST[ "ordr_idxx"      ]; // ���θ� �ֹ���ȣ
    $good_name      = $_POST[ "good_name"      ]; // ��ǰ��
    $good_mny       = $_POST[ "good_mny"       ]; // ���� �ѱݾ�
    $buyr_name      = $_POST[ "buyr_name"      ]; // �ֹ��ڸ�
    /* = -------------------------------------------------------------------------- = */
    $res_cd         = "";                                                     // �����ڵ�
    $res_msg        = "";                                                     // ���� �޼���
    /* = -------------------------------------------------------------------------- = */
    $card_cd        = "";                                                     // �ſ�ī�� �ڵ�
    $card_name      = "";                                                     // �ſ�ī�� ��
    $batch_key      = "";                                                     // ��ġ ����Ű
    /* = -------------------------------------------------------------------------- = */
    $param_opt_1    = $_POST[ "param_opt_1" ];
    $param_opt_2    = $_POST[ "param_opt_2" ];
    $param_opt_3    = $_POST[ "param_opt_3" ];
    /* ============================================================================== */
    /* =   01. ���� ��û ���� ���� END                                              = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   02. �ν��Ͻ� ���� �� �ʱ�ȭ                                              = */
    /* = -------------------------------------------------------------------------- = */
    /* =       ������ �ʿ��� �ν��Ͻ��� �����ϰ� �ʱ�ȭ �մϴ�.                     = */
    /* = -------------------------------------------------------------------------- = */
    $c_PayPlus = new C_PP_CLI;

    $c_PayPlus->mf_clear();
    /* ------------------------------------------------------------------------------ */
    /* =   02. �ν��Ͻ� ���� �� �ʱ�ȭ END                                          = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   03. ó�� ��û ���� ����                                                  = */
    /* = -------------------------------------------------------------------------- = */

    /* = -------------------------------------------------------------------------- = */
    /* =   03-1. ���� ��û                                                          = */
    /* = -------------------------------------------------------------------------- = */
    if ( $req_tx == "pay" )
    {
            /* 1004���� ������ ��ü���� �����ϼž� �� �� �ݾ��� �־��ּž� �մϴ�. �����ݾ� ��ȿ�� ���� */
            /* $c_PayPlus->mf_set_ordr_data( "ordr_mony",  "1004" );                                    */

            $c_PayPlus->mf_set_encx_data( $_POST[ "enc_data" ], $_POST[ "enc_info" ] );
    }
    /* ------------------------------------------------------------------------------ */
    /* =   03.  ó�� ��û ���� ���� END                                             = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   04. ����                                                                 = */
    /* = -------------------------------------------------------------------------- = */
    if ( $tran_cd != "" )
    {
        $c_PayPlus->mf_do_tx( $trace_no, $g_conf_home_dir, $g_conf_site_cd, $g_conf_site_key, $tran_cd, "",
                              $g_conf_gw_url, $g_conf_gw_port, "payplus_cli_slib", $ordr_idxx,
                              $cust_ip, $g_conf_log_level, 0, 0, $g_conf_log_path ); // ���� ���� ó��

        $res_cd  = $c_PayPlus->m_res_cd;  // ��� �ڵ�
        $res_msg = $c_PayPlus->m_res_msg; // ��� �޽���
    }
    else
    {
        $c_PayPlus->m_res_cd  = "9562";
        $c_PayPlus->m_res_msg = "���� ����|tran_cd���� �������� �ʾҽ��ϴ�.";
    }

    /* = -------------------------------------------------------------------------- = */
    /* =   04. ���� END                                                             = */
    /* ============================================================================== */

    /* ============================================================================== */
    /* =   05. ���� ��� �� ����                                                    = */
    /* = -------------------------------------------------------------------------- = */
    if ( $req_tx == "pay" )
    {
        if ( $res_cd == "0000" )
        {
            $card_cd   = $c_PayPlus->mf_get_res_data( "card_cd"   );       // ī�� �ڵ�
            $card_name = $c_PayPlus->mf_get_res_data( "card_name" );       // ī���
            $batch_key = $c_PayPlus->mf_get_res_data( "batch_key" );       // ��ġ ����Ű
        }
    }
    /* = -------------------------------------------------------------------------- = */
    /* =   05. ���� ��� ó�� END                                                   = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   06. ���� �� ���� ��� DBó��                                             = */
    /* = -------------------------------------------------------------------------- = */
    /* =       ����� ��ü ��ü������ DBó�� �۾��Ͻô� �κ��Դϴ�.                 = */
    /* = -------------------------------------------------------------------------- = */
    if ( $req_tx == "pay" )
    {
        if( $res_cd == "0000" )
        {
        }

    /* = -------------------------------------------------------------------------- = */
    /* =   06. ���� �� ���� ��� DBó��                                             = */
    /* ============================================================================== */
        else if ( $res_cd != "0000" )
        {
        }
    }

    /* ============================================================================== */
    /* =   07. �� ���� �� ��������� ȣ��                                           = */
    /* ============================================================================== */
?>
    <html>
    <head>
        <title>����Ʈ�� �� ����â</title>
        <script type="text/javascript">
            function goResult()
            {
                document.pay_info.submit()
            }

            // ���� �� ���ΰ�ħ ���� ���� ��ũ��Ʈ (�ߺ����� ����)
            function noRefresh()
            {
                /* CTRL + NŰ ����. */
                if ((event.keyCode == 78) && (event.ctrlKey == true))
                {
                    event.keyCode = 0;
                    return false;
                }
                /* F5 ��Ű ����. */
                if(event.keyCode == 116)
                {
                    event.keyCode = 0;
                    return false;
                }
            }
            document.onkeydown = noRefresh ;
        </script>
    </head>

    <body onload="goResult()">
    <form name="pay_info" method="post" action="./result.php">
        <input type="hidden" name="res_cd"          value="<?= $res_cd           ?>">    <!-- ��� �ڵ� -->
        <input type="hidden" name="res_msg"         value="<?= $res_msg          ?>">    <!-- ��� �޼��� -->
        <input type="hidden" name="ordr_idxx"       value="<?= $ordr_idxx        ?>">    <!-- �ֹ���ȣ -->
        <input type="hidden" name="good_mny"        value="<?= $good_mny         ?>">    <!-- �����ݾ� -->
        <input type="hidden" name="good_name"       value="<?= $good_name        ?>">    <!-- ��ǰ�� -->
        <input type="hidden" name="buyr_name"       value="<?= $buyr_name        ?>">    <!-- �ֹ��ڸ� -->

        <!-- �ſ�ī�� ���� -->
        <input type="hidden" name="card_cd"         value="<?= $card_cd          ?>">    <!-- ī���ڵ� -->
        <input type="hidden" name="card_name"       value="<?= $card_name        ?>">    <!-- ī���̸� -->
        <input type="hidden" name="batch_key"       value="<?= $batch_key        ?>">    <!-- ��ġ ����Ű -->

        <input type="hidden" name="param_opt_1"     value="<?= $param_opt_1 ?>">
        <input type="hidden" name="param_opt_2"     value="<?= $param_opt_2 ?>">
        <input type="hidden" name="param_opt_3"     value="<?= $param_opt_3 ?>">
    </form>
    </body>
    </html>
