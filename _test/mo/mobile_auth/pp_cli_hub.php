<?
    /* ============================================================================== */
    /* =   PAGE : ???? ??? ?? ??? ??? PAGE                                       = */
    /* = -------------------------------------------------------------------------- = */
    /* =   ?????? ?????? ?????? ??? ????? ???? ???????? ??????? ??????.= */
    /* =   ???? ??? : http://kcp.co.kr/technique.requestcode.do			        = */
    /* = -------------------------------------------------------------------------- = */
    /* =   Copyright (c)  2013   KCP Inc.   All Rights Reserverd.                   = */
    /* ============================================================================== */

    /* ============================================================================== */
    /* =   ??? ???? ???? Include                                                   = */
    /* = -------------------------------------------------------------------------- = */
    /* =   ?? ???                                                                  = */
    /* =   ???? ?? ????? ?????? site_conf_inc.php?????? ???????? ??????.     = */
    /* = -------------------------------------------------------------------------- = */

    /* = -------------------------------------------------------------------------- = */
    /* =   ??? ???? ???? Include END                                               = */
    /* ============================================================================== */
?>
<?include_once $_SERVER['DOCUMENT_ROOT'] . "/kcp/cfg/site_mbconf_inc.php";?>
<?include_once $_SERVER['DOCUMENT_ROOT'] . "/_test/mo/mobile_auth/pp_cli_hub_lib.php";?>
<?
    /* ============================================================================== */
    /* =   POST ???? ???リ?                                                       = */
    /* = -------------------------------------------------------------------------- = */
    if ( $_SERVER['REQUEST_METHOD'] != "POST" )
    {
        echo("????? ??ョ? ????????????.");
        exit;
    }
    /* ============================================================================== */
?>

<?
    /* ============================================================================== */
    /* =   01. ???? ??? ???? ????                                                  = */
    /* = -------------------------------------------------------------------------- = */
    $cust_ip        = getenv( "REMOTE_ADDR"    ); // ??? IP
    /* = -------------------------------------------------------------------------- = */
    $req_tx         = $_POST[ "req_tx"         ]; // ??? ????
    $tran_cd        = $_POST[ "tran_cd"        ]; // ??? ????
    /* = -------------------------------------------------------------------------- = */
    $ordr_idxx      = $_POST[ "ordr_idxx"      ]; // ???ヨ? ??????
    $good_name      = $_POST[ "good_name"      ]; // ?????
    $good_mny       = $_POST[ "good_mny"       ]; // ???? ????
    $buyr_name      = $_POST[ "buyr_name"      ]; // ??????
    /* = -------------------------------------------------------------------------- = */
    $res_cd         = "";                                                     // ???????
    $res_msg        = "";                                                     // ???? ?????
    /* = -------------------------------------------------------------------------- = */
    $card_cd        = "";                                                     // ?????? ???
    $card_name      = "";                                                     // ?????? ??
    $batch_key      = "";                                                     // ??? ?????
    /* = -------------------------------------------------------------------------- = */
    $param_opt_1    = $_POST[ "param_opt_1" ];
    $param_opt_2    = $_POST[ "param_opt_2" ];
    $param_opt_3    = $_POST[ "param_opt_3" ];
    /* ============================================================================== */
    /* =   01. ???? ??? ???? ???? END                                              = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   02. ?ロ???? ???? ?? ????                                              = */
    /* = -------------------------------------------------------------------------- = */
    /* =       ?????? ????? ?ロ?????? ??????? ???? ????.                     = */
    /* = -------------------------------------------------------------------------- = */
    $c_PayPlus = new C_PP_CLI;

    $c_PayPlus->mf_clear();
    /* ------------------------------------------------------------------------------ */
    /* =   02. ?ロ???? ???? ?? ???? END                                          = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   03. ??? ??? ???? ????                                                  = */
    /* = -------------------------------------------------------------------------- = */

    /* = -------------------------------------------------------------------------- = */
    /* =   03-1. ???? ???                                                          = */
    /* = -------------------------------------------------------------------------- = */
    if ( $req_tx == "pay" )
    {
            /* 1004???? ?????? ??????? ???????? ?? ?? ????? ??????? ????. ??????? ????? ???? */
            /* $c_PayPlus->mf_set_ordr_data( "ordr_mony",  "1004" );                                    */

            $c_PayPlus->mf_set_encx_data( $_POST[ "enc_data" ], $_POST[ "enc_info" ] );
    }
    /* ------------------------------------------------------------------------------ */
    /* =   03.  ??? ??? ???? ???? END                                             = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   04. ????                                                                 = */
    /* = -------------------------------------------------------------------------- = */
    if ( $tran_cd != "" )
    {
        $c_PayPlus->mf_do_tx( $trace_no, $g_conf_home_dir, $g_conf_site_cd, $g_conf_site_key, $tran_cd, "",
                              $g_conf_gw_url, $g_conf_gw_port, "payplus_cli_slib", $ordr_idxx,
                              $cust_ip, $g_conf_log_level, 0, 0, $g_conf_log_path ); // ???? ???? ???

        $res_cd  = $c_PayPlus->m_res_cd;  // ??? ???
        $res_msg = $c_PayPlus->m_res_msg; // ??? ?????
    }
    else
    {
        $c_PayPlus->m_res_cd  = "9562";
        $c_PayPlus->m_res_msg = "???? ????|tran_cd???? ???????? ???????.";
    }

    /* = -------------------------------------------------------------------------- = */
    /* =   04. ???? END                                                             = */
    /* ============================================================================== */

    /* ============================================================================== */
    /* =   05. ???? ??? ?? ????                                                    = */
    /* = -------------------------------------------------------------------------- = */
    if ( $req_tx == "pay" )
    {
        if ( $res_cd == "0000" )
        {
            $card_cd   = $c_PayPlus->mf_get_res_data( "card_cd"   );       // ??? ???
            $card_name = $c_PayPlus->mf_get_res_data( "card_name" );       // ????
            $batch_key = $c_PayPlus->mf_get_res_data( "batch_key" );       // ??? ?????
        }
    }
    /* = -------------------------------------------------------------------------- = */
    /* =   05. ???? ??? ??? END                                                   = */
    /* ============================================================================== */


    /* ============================================================================== */
    /* =   06. ???? ?? ???? ??? DB???                                             = */
    /* = -------------------------------------------------------------------------- = */
    /* =       ????? ??? ????????? DB??? ??????? ?リ?????.                 = */
    /* = -------------------------------------------------------------------------- = */
    if ( $req_tx == "pay" )
    {
        if( $res_cd == "0000" )
        {
        }

    /* = -------------------------------------------------------------------------- = */
    /* =   06. ???? ?? ???? ??? DB???                                             = */
    /* ============================================================================== */
        else if ( $res_cd != "0000" )
        {
        }
    }

    /* ============================================================================== */
    /* =   07. ?? ???? ?? ????????? ???                                           = */
    /* ============================================================================== */
?>
    <html>
    <head>
        <title>??????? ?? ?????</title>
        <script type="text/javascript">
            function goResult()
            {
                document.pay_info.submit()
            }

            // ???? ?? ????? ???? ???? ?????? (??????? ????)
            function noRefresh()
            {
                /* CTRL + N? ????. */
                if ((event.keyCode == 78) && (event.ctrlKey == true))
                {
                    event.keyCode = 0;
                    return false;
                }
                /* F5 ??? ????. */
                if(event.keyCode == 116)
                {
                    event.keyCode = 0;
                    return false;
                }
            }
            document.onkeydown = noRefresh ;
        </script>
    </head>

    <body onload="goResult()">
    <form name="pay_info" method="post" action="./result.php">
        <input type="hidden" name="res_cd"          value="<?= $res_cd           ?>">    <!-- ??? ??? -->
        <input type="hidden" name="res_msg"         value="<?= $res_msg          ?>">    <!-- ??? ????? -->
        <input type="hidden" name="ordr_idxx"       value="<?= $ordr_idxx        ?>">    <!-- ?????? -->
        <input type="hidden" name="good_mny"        value="<?= $good_mny         ?>">    <!-- ??????? -->
        <input type="hidden" name="good_name"       value="<?= $good_name        ?>">    <!-- ????? -->
        <input type="hidden" name="buyr_name"       value="<?= $buyr_name        ?>">    <!-- ?????? -->

        <!-- ?????? ???? -->
        <input type="hidden" name="card_cd"         value="<?= $card_cd          ?>">    <!-- ?????? -->
        <input type="hidden" name="card_name"       value="<?= $card_name        ?>">    <!-- ?????? -->
        <input type="hidden" name="batch_key"       value="<?= $batch_key        ?>">    <!-- ??? ????? -->

        <input type="hidden" name="param_opt_1"     value="<?= $param_opt_1 ?>">
        <input type="hidden" name="param_opt_2"     value="<?= $param_opt_2 ?>">
        <input type="hidden" name="param_opt_3"     value="<?= $param_opt_3 ?>">
    </form>
    </body>
    </html>
